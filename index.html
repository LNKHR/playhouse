<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Playhouse</title>

  <!-- Bootstrap CDN -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css"
    integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">

  <!-- Toyhou.se Theme -->
  <link href="/toyhouse_themes/night.css" title="thThemes" id="thThemes" rel="stylesheet" type="text/css" />

  <style>

    iframe {
      bottom: 0;
      position: relative;
      width: 100%;
      border: 0;
    }

    .ace_editor{
      height: 100%;
    }

  </style>
</head>
<body>
  <nav class="navbar navbar-toggleable-md navbar-inverse">
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="#">Playhou.se</a>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a class="nav-link" href="#">Home</a>
        </li>
        <li class="nav-item">
          <form>
            <select class="dropdown" id="thCSSThemes">
              <option value="../toyhouse_themes/default.css">Default</option>
              <option selected="selected" value="../toyhouse_themes/night.css">Night</option>
              <option value="../toyhouse_themes/pink.css">Pink</option>
              <option value="../toyhouse_themes/teal.css">Teal</option>
              <option value="../toyhouse_themes/bee.css">Bee</option>
              <option value="../toyhouse_themes/velvet.css">Velvet</option>
            </select>
          </form>
        </li>
      </ul>
    </div>
  </nav>

  <div class="row no-gutters" style="min-height: calc(100vh - 43px)">
    <div class="col-4">
      <textarea id="html"></textarea>
    </div>
    <div class="col-8 p-4">
      <iframe id="code"></iframe>
    </div>
  </div>
  
  <!-- Font Awesome -->
  <script src="https://kit.fontawesome.com/0d9ecae968.js" crossorigin="anonymous"></script>

  <!-- Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js"
    integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"
    integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb"
    crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js"
    integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn"
    crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/0d9ecae968.js" crossorigin="anonymous"></script>
  
  <!-- Ace Editor -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.9/ace.js"></script>

  <script>

    var editor = ace.edit("html");
    editor.setTheme("ace/theme/tomorrow_night");
    editor.session.setMode("ace/mode/html");
    editor.session.setUseWrapMode(true);
    
    function setStyleSource (linkID, sourceLoc) {
      var theLink = document.getElementById(linkID);
      theLink.href = sourceLoc;
    }

    document.getElementById("thCSSThemes").addEventListener("change", function(){
      var selected = this.options[this.selectedIndex].value;
      setStyleSource ("thThemes", selected)
    });

    (function(test) {
      let code = document.getElementById("code").contentWindow.document;
      editor.addEventListener('change', function() {    
        let e = document.getElementById("thCSSThemes");  
        code.open();
        code.writeln(
          `<head><link href="` + e.options[e.selectedIndex].value + `" rel="stylesheet" type="text/css" /></head>` + 
          editor.getValue()
        );
        code.close();
      });
      console.log(e);
    })()

  </script>

</body>
</html>